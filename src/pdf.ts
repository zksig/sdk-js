import type { Signer } from "ethers";
import { UnixFS } from "ipfs-unixfs";
import { CID } from "multiformats/cid";
import * as codec from "@ipld/dag-pb";
import { sha256 } from "multiformats/hashes/sha2";
import { PDFDocument, PDFImage } from "pdf-lib";
import { createAgreement } from "./contract";

export type AgreementDescription = { identifier: string; fields: string[] }[];

export type AddSignatureFieldOptions = {
  x: number;
  y: number;
  page: number;
  identifier: string;
};

export class ZKsigAgreement {
  private _identifier: string = "";
  private _description: AgreementDescription = [];
  private _doc: PDFDocument | null = null;
  private _signatureImage: PDFImage | null = null;

  async init(pdf: Uint8Array) {
    this._doc = await PDFDocument.load(pdf);
    this._description = [];
  }

  get isInitialized() {
    return !!this._doc;
  }

  getIdentifier() {
    return this._identifier;
  }

  setIdentifier(identifier: string) {
    this._identifier = identifier;
  }

  getDescription() {
    return this._description;
  }

  getTotalPages() {
    if (!this.isInitialized) {
      throw new Error("Uninitialized. Call the .init(pdf) method");
    }

    return this._doc!.getPageCount();
  }

  async createOnChain(signer: Signer) {
    if (!this.isInitialized) {
      throw new Error("Uninitialized. Call the .init(pdf) method");
    }

    return createAgreement({
      signer,
      identifier: this._identifier,
      pdf: await this.toBytes(),
      description: this._description,
    });
  }

  async toBytes() {
    if (!this.isInitialized) {
      throw new Error("Uninitialized. Call the .init(pdf) method");
    }
    return this._doc!.save();
  }

  async getCID() {
    const data = new UnixFS({ type: "file", data: await this.toBytes() });

    return CID.create(
      0,
      codec.code,
      await sha256.digest(codec.encode({ Data: data.marshal(), Links: [] }))
    );
  }

  addSigner(identifier: string) {
    this._setDescription(identifier);
  }

  renameSigner(oldIdentifier: string, newIdentifier: string) {
    this._description = this._description.map((signer) => {
      if (signer.identifier !== oldIdentifier) return signer;
      return { ...signer, identifier: newIdentifier };
    });
  }

  async addSignatureField({
    x,
    y,
    page,
    identifier,
  }: AddSignatureFieldOptions) {
    if (!this.isInitialized) {
      throw new Error("Uninitialized. Call the .init(pdf) method");
    }

    if (!this._signatureImage) {
      this._signatureImage = await this._doc!.embedPng(
        "data:image/png;base64,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EAABCBTOARAAARAAAS4JQKC4LAuCAgEQAAEQgEDhHAABEAABEOCSAASKy7IgKBAAARAAAQgUzgEQAAEQAAEuCUCguCwLggIBEAABEIBA4RwAARAAARDgkgAEisuyICgQAAEQAAEIFM4BEAABEAABLglAoLgsC4ICARAAARCAQOEcAAEQAAEQ4JIABIrLsiAoEAABEAABb9YIOnVsT507dmDtFv5AAARAAAQMILB5y1b6bcsfBliq3gRzgVLFadzzw6uPDC1AAARAAAT4I7CQmAkULvHxV35EBAIgAAIgoBCAQOE0AAEQAAEQ4JIABIrLsiAoEAABEAABCBTOARAAARAAAS4JQKC4LAuCAgEQAAEQgEDhHAABEAABEOCSAASKy7IgKBAAARAAAQgUzgEQAAEQAAEuCUCguCwLggIBEAABEIBA4RwAARAAARDgkgAEisuyICgQAAEQAAHmc/E5g/y33/+gzb9tdaYr+oAACIAACFRBoHOnDtTpxvZVHDV/txACpYrTvIXLzaeFCEAABEBAMgI8CxQu8Ul2siEdEAABEJCFAARKlkoiDxAAARCQjAAESrKCIh0QAAEQkIUABEqWSiIPEAABEJCMAARKsoIiHRAAARCQhQAESpZKIg8QAAEQkIwABEqygiIdEAABEJCFAARKlkoiDxAAARCQjAAESrKCIh0QAAEQkIUABEqWSiIPEAABEJCMAARKsoIiHRAAARCQhQAESpZKIg8QAAEQkIwABEqygiIdEAABEJCFAARKlkoiDxAAARCQjAAESrKCIh0QAAEQkIUABEqWSiIPEAABEJCMAARKsoIiHRAAARCQhQAESpZKIg8QAAEQkIwABEqygiIdEAABEJCFAARKlkoiDxAAARCQjAAESrKCIh0QAAEQkIUABEqWSiIPEAABEJCMAARKsoIiHRAAARCQhQAESpZKIg8QAAEQkIwABEqygiIdEAABEJCFAARKlkoiDxAAARCQjAAESrKCIh0QAAEQkIUABEqWSiIPEAABEJCMAARKsoIiHRAAARCQhQAESpZKIg8QAAEQkIwABEqygiIdEAABEJCFAARKlkoiDxAAARCQjAAESrKCIh0QAAEQkIUABEqWSiIPEAABEJCMgLdk+SAdEAABRgSCvULI3zOAArwCyF95+Xr4UmFpARWWF1J+aT4VqO/L8hlFAzcyEoBA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"
      );
    }

    const pdfPage = this._doc!.getPage(page - 1);
    const fieldName = Date.now().toString();

    const button = this._doc!.getForm().createButton(`button-${fieldName}`);
    button.addToPage("", pdfPage, {
      x,
      y,
      width: 20,
      height: 14,
      borderWidth: 0,
    });
    button.setImage(this._signatureImage);

    const field = this._doc!.getForm().createTextField(fieldName);
    field.setText(`${identifier} signature`);
    field.addToPage(pdfPage, {
      x: x + 20,
      y,
      width: 80,
      height: 14,
      borderWidth: 0,
    });

    this._setDescription(identifier, fieldName);
  }

  private _setDescription(identifier: string, fieldName?: string) {
    const index = this._description.findIndex(
      (signer) => signer.identifier === identifier
    );

    if (index < 0) {
      this._description = [
        ...this._description,
        { identifier, fields: fieldName ? [fieldName] : [] },
      ];
      return;
    }

    if (!fieldName) return;

    this._description = this._description.map((signer) => {
      if (signer.identifier !== identifier) return signer;

      return { ...signer, fields: [...signer.fields, fieldName] };
    });
  }
}
